---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load libraries}
# rm(list = ls())
library(brms)
library(rtdists)

```

```{r loading and cleaning data}

setwd("C:/Users/pscmgo/OneDrive for Business/PhD/Project/Experiment_Code/Straights") # set working directory
# setwd("C:/Users/Courtney/Documents/PhD/Project/Experiment_code/Straights")
temp = list.files(pattern = c("dat2", "*.csv")) # list all CSV files in the directory
myfiles = lapply(temp, read.csv) # read these CSV in the directory
dat2 <- do.call(rbind.data.frame, myfiles) # convert and combine the CSV files into dataframe

# nosteer <- dat2 %>%
#   filter(response == "nosteer") %>%
#   mutate(response_num = 0)
# 
# steer <- dat2 %>%
#   filter(response == "steer") %>%
#   mutate(response_num = 1)

dat3 <- dat2 # rbind(steer, nosteer)

dat3$heading <- as.factor(dat3$heading)
dat3$pNum <- as.factor(dat3$pNum)

View(dat3)

```
Changes repsonse_num to lower bound = 0, upper bound = 1 to match example and change variables to factors


```{r model formula}

formula <- bf(FirstSteeringTime | dec(response_num) ~ 0 + heading + 
                (0 + heading|p|pNum), 
               bs ~ 0 + heading + (0 + heading|p|pNum), 
               ndt ~ 0 + heading + (0 + heading|p|pNum),
               bias ~ 0 + heading + (0 + heading|p|pNum))


```
Above code sets the model forumula. Specifies reaction time column, response (dec) column. Drift rate is allowed to vary depending on the heading value.

bs, ndt and bias are all parameters in the model, that are allowed to vary depending on the heading for each participant

```{r get priors for model parameters}

get_prior(formula,
          data = dat3, 
          family = wiener(link_bs = "identity", 
                          link_ndt = "identity", 
                          link_bias = "identity"))

```

```{r priors for nondecision time, boundary and drift rate}

prior <- c(
 prior("cauchy(0, 5)", class = "b"),
 set_prior("normal(1.5, 1)", class = "b", dpar = "bs"),
 set_prior("normal(0.2, 0.1)", class = "b", dpar = "ndt"),
 set_prior("normal(0.5, 0.2)", class = "b", dpar = "bias")
)


```

```{r inspect full model code}
make_stancode(formula, 
              family = wiener(link_bs = "identity", 
                              link_ndt = "identity",
                              link_bias = "identity"),
              data = dat3, 
              prior = prior)

```

```{r initial value generator}
tmp_dat <- make_standata(formula, 
                         family = wiener(link_bs = "identity", 
                              link_ndt = "identity",
                              link_bias = "identity"),
                            data = dat3, prior = prior)

str(tmp_dat, 1, give.attr = FALSE)
```

